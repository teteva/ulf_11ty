{%- if site.search and site.search.url -%}
  {%- if onsubmit == nil or onsubmit == "" -%}
    {%- assign onsubmit = "submitQuery(event);" %}
  {%- endif -%}
  {%- if focus -%}
    {%- assign autofocus = "autofocus" -%}
  {%- endif -%}

  <form
    id='search-form'
    class="legible-base-width"
    onsubmit="{{onsubmit}}">
    <label
      id="search-label"
      for="search-query"
      class="font-display font-bold">Search
      {{ site.name }}
      <div class="flex flex-row">
        <input
          id="search-query"
          {{ autofocus }}
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          type="text"
          suggestion-wrapper-id="autocomplete-search"
          class="grow self-stretch"
          type="text" />
        <input
          type="submit"
          id="search-submit"
          style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;"
          value="Search" />
      </div>
    </label>
    <ul id="autocomplete-search"></ul>

    <script>
      async function suggest(input, callback) {
        try {
          let response = await fetch('/api/search-suggest/?query=' + encodeURIComponent(input));
          let suggestions = await response.json();
          callback(null, suggestions.map(entry => entry.suggestion));
        } catch (error) {
          callback(error, []);
        }
      }

      function submitQuery(event) {
        if (event) {
          event.preventDefault();
        }
        let query = document.querySelector('#search-query').value;
        if (query && query.trim()) {
          location.href = '{{site.search.url}}' + '?query=' + encodeURIComponent(query.trim());
        } else {
          location.href = '{{site.search.url}}';
        }
      }


      addEventListener('DOMContentLoaded', function(event) {
        AutoComplete.init({selector: '#search-query', data: suggest, threshold: 2, onSelect: submitQuery});
      });
    </script>

  </form>



{%- endif -%}
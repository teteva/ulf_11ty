{%- if tag != nil -%}
    {% assign livePosts = collections[tag] | live | post %}
    {%- elsif sitetags != nil or limit > 0 -%}
    {% assign livePosts = collections.livePosts %}
{%- endif %}

{%- for p in livePosts reversed -%}

    {%- if limit > 0 and forloop.index > limit -%}
        {%- break -%}
    {%- endif -%}

    {%- if p.url == page.url -%}
        {%- continue -%}
    {%- endif -%}

    {%- assign pageYear = p.date | date: '%Y' -%}

    {%- assign href = p.url -%}

    {%- if indexYear != pageYear and limit == nil -%}
        <time datetime="{{pageYear}}" class="bleed-left larger meta mry-vrplus block year sticky top-0 bg-base-background">{{pageYear}}</time>
        {%- assign indexYear = pageYear -%}
    {%- endif -%}

    {%- assign count = count | plus: 1 -%}

    <article class="mry-vrplus lg:bleed-left lg:flex-row-reverse lg:align-baseline">

        <section class="lg:w-rg lg:flex-shrink-0">
            {%- if p.data.title != "" and p.data.title != nil and p.data.title != "notitle" and p.data.notitle == nil -%}
                <h3 class="mry-0 fs lh-default">
                    <a href="{{p.url}}">
                        {{ p.data.title }}
                    </a>
                </h3>
            {%- endif -%}
            {%- if p.data.subtitle -%}
                <p>{{p.data.subtitle}}</p>
                {%- elsif p.data.abstract -%}
                <p>{{p.data.abstract}}</p>
            {%- else -%}
                {% assign abstract = p.templateContent | strip_html | strip | truncatewords : 25,
                "&nbsp;…" %}
                {%- if abstract != "" -%}
                    <p>{{ abstract }}</p>
                {%- endif -%}
            {%- endif -%}

            {%- if p.data.title == "" or p.data.title == nil or p.data.title == "notitle" or p.data.notitle != nil -%}
                <a href="{{p.url}}">Read more</a>
            {%- endif -%}
        </section>
        <aside class="meta lg:smaller lg:pdr-1 lg:mrl-auto lg:right lg:flex-column {{p.data.starred}}">
            {% include "date-tags.html" posted: p.date tags: p.data.tags notags: p.data.notags %}            
        </aside>
    </article>

{%- endfor -%}

{%- if livePosts.length > limit -%}
    {%- if tag != nil -%}
        {%-assign currentTags = collections.usedSiteTags | concat: tag | uniq | compact -%}
    {%- else - %}
        {%-assign currentTags = collections.usedSiteTags -%}
    {%- endif -%}
    {%- if currentTags.length -%}
        <h2 class="normal fs lh-default">There are more posts. Choose a tag:</h2>
        {%- include "site-tags.html" tag:tag-%}
    {%- else -%}
        <a href="{{site.blog}}">There are more posts …</a>
    {%- endif %}
{%- endif -%}
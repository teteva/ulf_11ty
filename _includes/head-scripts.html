<script defer src="/js/site-scripts-{{site.cacheVersioning.script}}.js"></script>
<script defer src="/js/sotable-{{site.cacheVersioning.script}}.js"></script>
<script defer src="/js/active-toc-{{site.cacheVersioning.script}}.js"></script>
<script>
  addEventListener('keydown', event => {
    let focus = document.querySelector(':focus');

    if (focus && 'INPUT' == focus.tagName && 'submit' != focus.type && 'reset' != focus.type) {
      return;
    } else if (focus && 'TEXTAREA' == focus.tagName) {
      return;
    }

    if (!(event.altKey || event.ctrlKey || event.metaKey || event.shiftKey)) {
      if ('{{site.search.url}}' && event.key === '{{site.search.kbd}}') {
        let queryField = document.querySelector('#search-query');
        if (queryField && queryField != focus) {
          queryField.focus();
          event.preventDefault();
          return;
        } else if (! queryField) {
          location.href = '{{site.search.url}}';
          event.preventDefault();
          return;
        }
      }

      if ('{{site.navNext.id}}' && event.key === '{{site.navNext.kbd}}') {
        let navNext = document.querySelector(`#{{site.navNext.id}}`);
        if (navNext) {
          location.href = navNext.href;
          event.preventDefault();
        }
      }


      if ('{{site.navPrevious.id}}' && event.key === '{{site.navPrevious.kbd}}') {
        let navPrevious = document.querySelector(`#{{site.navPrevious.id}}`);
        if (navPrevious) {
          location.href = navPrevious.href;
          event.preventDefault();
        }
      }

      if ('{{site.backToTop.id}}' && event.key === '{{site.backToTop.kbd}}') {
        location.href = `#{{site.backToTop.id}}`;
        event.preventDefault();
      }

      for (let nav of {{site.mainnav | json}}) {
        if (event.key == nav.kbd && nav.url) {
          if (nav.id == 'editOnGitHub') {
            window.open(nav.url + '{{page.inputPath}}', '_blank');
          } else {
            location.href = nav.url;
          }
          event.preventDefault();
          return;
        }
      }

      for (let nav of {{site.footernav | json}}) {
        if (event.key == nav.kbd && nav.url) {
          event.preventDefault();
          if (nav.id == 'editOnGitHub') {
            window.open(nav.url + '{{page.inputPath}}', '_blank');
          } else {
            location.href = nav.url;
          }
          return;
        }
      }
    }
  });
  addEventListener('load', () => {
    sotable()
  });
</script>